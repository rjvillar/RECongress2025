# RE Congress 2025 - Apache/LiteSpeed Configuration
# For Hostinger subdirectory deployment at /recongress2025/

# ===========================================
# CRITICAL: Disable LiteSpeed Cache for this folder
# ===========================================
<IfModule LiteSpeed>
  CacheLookup off
</IfModule>

# Set default index file
DirectoryIndex index.html

# Allow access to all files
Options +FollowSymLinks -Indexes
Satisfy Any
Allow from all

# ===========================================
# Force correct MIME types (CRITICAL for CSS/JS/Fonts)
# ===========================================
AddType text/css .css
AddType application/javascript .js .mjs
AddType application/json .json
AddType text/html .html .htm
AddType image/svg+xml .svg .svgz
AddType image/png .png
AddType image/jpeg .jpg .jpeg .jpe
AddType image/webp .webp
AddType image/gif .gif
AddType image/x-icon .ico
AddType font/woff .woff
AddType font/woff2 .woff2
AddType application/font-woff .woff
AddType application/font-woff2 .woff2
AddType font/ttf .ttf
AddType font/otf .otf
AddType application/vnd.ms-fontobject .eot

# ===========================================
# Headers for fonts and assets (CORS + Content-Type)
# ===========================================
<IfModule mod_headers.c>
  # Allow fonts to be loaded cross-origin
  <FilesMatch "\.(woff|woff2|ttf|otf|eot)$">
    Header set Access-Control-Allow-Origin "*"
    Header set Cache-Control "public, max-age=31536000"
  </FilesMatch>
  
  # Ensure CSS files are served correctly
  <FilesMatch "\.css$">
    Header set Content-Type "text/css; charset=utf-8"
  </FilesMatch>
  
  # Ensure JS files are served correctly
  <FilesMatch "\.js$">
    Header set Content-Type "application/javascript; charset=utf-8"
  </FilesMatch>
</IfModule>

# ===========================================
# URL Rewriting
# ===========================================
<IfModule mod_rewrite.c>
  RewriteEngine On
  
  # Serve existing files/directories directly
  RewriteCond %{REQUEST_FILENAME} -f [OR]
  RewriteCond %{REQUEST_FILENAME} -d
  RewriteRule ^ - [L]
  
  # Add trailing slash to directories
  RewriteCond %{REQUEST_FILENAME} -d
  RewriteCond %{REQUEST_URI} !/$
  RewriteRule ^(.*)$ $1/ [L,R=301]

  # Serve /_next/static files (and let missing ones 404) before the SPA rewrite
  RewriteRule ^_next/static/ - [L]
  RewriteCond %{REQUEST_URI} ^/_next/static/
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteRule . - [R=404,L]
  
  # Fallback to index.html for client-side routing
  RewriteRule ^ index.html [L]
</IfModule>

# ===========================================
# Security Headers
# ===========================================
<IfModule mod_headers.c>
  Header set X-Content-Type-Options "nosniff"
  Header set X-Frame-Options "SAMEORIGIN"
</IfModule>

# ===========================================
# Caching for performance
# ===========================================
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType text/css "access plus 1 year"
  ExpiresByType application/javascript "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/svg+xml "access plus 1 year"
  ExpiresByType font/woff2 "access plus 1 year"
</IfModule>
<IfModule mod_expires.c>
  ExpiresActive On
  
  # Default expiration
  ExpiresDefault "access plus 1 month"
  
  # HTML - no cache (always fresh)
  ExpiresByType text/html "access plus 0 seconds"
  
  # CSS and JavaScript - 1 month
  ExpiresByType text/css "access plus 1 month"
  ExpiresByType application/javascript "access plus 1 month"
  
  # Images - 1 year
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType image/gif "access plus 1 year"
  ExpiresByType image/webp "access plus 1 year"
  ExpiresByType image/svg+xml "access plus 1 year"
  ExpiresByType image/x-icon "access plus 1 year"
  
  # Fonts - 1 year
  ExpiresByType font/woff "access plus 1 year"
  ExpiresByType font/woff2 "access plus 1 year"
  ExpiresByType font/ttf "access plus 1 year"
  ExpiresByType font/otf "access plus 1 year"
  ExpiresByType font/eot "access plus 1 year"
  
  # JSON and XML
  ExpiresByType application/json "access plus 0 seconds"
  ExpiresByType application/xml "access plus 0 seconds"
</IfModule>

# Cache-Control headers
<IfModule mod_headers.c>
  # HTML files - no cache
  <FilesMatch "\.(html)$">
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires 0
  </FilesMatch>
  
  # Static assets - long cache
  <FilesMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg|webp|woff|woff2|ttf|otf|eot)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
  </FilesMatch>
  
  # Security headers
  Header always set X-Content-Type-Options "nosniff"
  Header always set X-Frame-Options "SAMEORIGIN"
  Header always set X-XSS-Protection "1; mode=block"
  Header always set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# Custom error pages (optional)
ErrorDocument 404 /recongress2025/404.html
